# ==========================================
#  CLASS Input Parameters: IDM Newtonian
# ==========================================

# --- Interacting Dark Matter (IDM) Physics ---
# These are placeholders commented out so your Python script can inject them.
sigma_dmeff = 1.6e-23
m_dmeff = 1
npow_dmeff = 2

# --- Output Configuration ---
root = COZMIC_test_output/idm_run_n2_m1ep00_s1.6e-23_halfmode_newtonian
output = vTk               # Critical: Requests Velocity Transfer Functions (vTk).
                           # This gives us the 't_dmeff' (theta_cdm) and 't_b' (theta_b) columns needed for the velocity formula.
modes = s                  # s = scalars.
ic = ad                    # ad = adiabatic.
gauge = Newtonian          # Critical: Newtonian gauge defines non-zero velocities for DM.
format = class             # 'class' format usually outputs more detailed velocity columns than 'camb'.

# --- Cosmology (Background) ---
h = 0.7
T_cmb = 2.7255
Omega_b = 0.049
omega_cdm = 1e-15          # Standard CDM off.
Omega_dmeff = 0.237        # IDM on.
#Omega_m = 0.286

# --- Neutrinos ---
#N_ur = 3.046               # Massless neutrinos (Standard for IDM zoom-ins).
#N_ncdm = 0               
N_ur = 2.0328
N_ncdm = 1
m_ncdm = 0.06
Omega_k = 0.

# --- Thermodynamics ---
YHe = BBN
recombination = HyRec
reio_parametrization = reio_camb
z_reio = 7.6711
reionization_exponent = 1.5
reionization_width = 0.5
helium_fullreio_redshift = 3.5
helium_fullreio_width = 0.5
varying_fundamental_constants = none

# --- IDM Details ---
Omega_dcdmdr = 0.0
stat_f_idr = 0.875
Omega_idm_dr = 0.
alpha_idm_dr = 1.5
beta_idr = 1.5
Omega_fld = 0
Omega_scf = 0
dmeff_target = hydrogen
Vrel_dmeff = 0.0
f_eff_type = on_the_spot
chi_type = CK_2004

# --- Exotic Injection (Disabled) ---
DM_annihilation_efficiency = 0.
DM_decay_fraction = 0.
DM_decay_Gamma = 0.
PBH_evaporation_fraction = 0.
PBH_evaporation_mass = 0.
PBH_accretion_fraction = 0.
PBH_accretion_mass = 0.
PBH_accretion_recipe = disk_accretion
PBH_accretion_ADAF_delta = 1.e-3
PBH_accretion_eigenvalue = 0.1

# --- Primordial Power Spectrum ---
Pk_ini_type = analytic_Pk
k_pivot = 0.05
sigma8 = 0.82
n_s = 0.96
alpha_s = 0.

# --- Output Settings ---
z_pk = 99                  # Redshift 99 for Initial Conditions.
lensing = no
sd_branching_approx = exact
sd_PCA_size = 2
sd_detector_name = PIXIE
sd_only_exotic = no
sd_include_g_distortion = no
sd_add_y = 0.
sd_add_mu = 0.
include_SZ_effect = no
overwrite_root = no
headers = yes

# --- Writing Options ---
write_background = yes     # Critical: We NEED the background file to get H(z) for the velocity conversion formula.
write_thermodynamics = no
write_primordial = no
write_exotic_injection = no
write_distortions = no
write_parameters = yes
write_warnings = no

# =========================================================
#  THE FIX: High Precision Settings for Small-Scale Cutoffs
# =========================================================

# 1. Scale Range
# Increased from 200 to 300. 
# Ensures we capture the full velocity tail, preventing cutoff errors in the calculation.
P_k_max_1/Mpc = 200.

# 2. Sampling Density
# High sampling prevents "blocky" velocity curves, which reduces interpolation error.
k_per_decade_for_pk = 50

# 3. Angular Precision
# Required for accuracy at very high k (small scales).
l_max_scalars = 5000

# 4. Integration Tolerances
# Forces the solver to track tiny velocity perturbations (1e-10) without giving up.
# This prevents the velocities from hitting a "noise floor" and creating wobbles.
tol_ncdm_bg = 1.e-10
tol_ncdm_synchronous = 1.e-10
tol_ncdm_newtonian = 1.e-10
tol_perturbations_integration = 1.e-8
tol_background_integration = 1.e-8
