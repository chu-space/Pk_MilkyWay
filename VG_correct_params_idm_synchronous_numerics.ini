# ==========================================
#  CLASS Input Parameters: IDM Synchronous
# ==========================================

# --- Interacting Dark Matter (IDM) Physics ---
# These control the "Cutoff" shape and location in the Transfer Function.
sigma_dmeff = 1.6e-23      # Cross-section (cm^2). Higher = Stronger suppression (Cutoff moves to lower k).
m_dmeff = 1           # DM Mass (GeV).
npow_dmeff = 2             # Power dependency (v^n). n=4 is used for COZMIC/Ethos models.

# --- Output Configuration ---
root = COZMIC_test_output/idm_run_n2_m1ep00_s1.6e-23_halfmode_synchronous
output = dTk               # Critical: Requests density Transfer Functions (Tk).
modes = s                  # s = scalars (standard density perturbations).
ic = ad                    # ad = adiabatic (standard initial conditions).
gauge = synchronous        # Critical: Used for DENSITY (delta) precision. 
                           # Note: We run a separate Newtonian run for VELOCITIES.
format = camb              # Requests CAMB-style output formatting (k/h units).

# --- Cosmology (Background) ---
# These determine the shape of the power spectrum peak and time of equality.
h = 0.7                    # Hubble parameter (H0 = 100*h). Sets the horizontal scale (h/Mpc).
T_cmb = 2.7255             # CMB Temp. Affects radiation density.
Omega_b = 0.049            # Baryon density. Controls Baryon Acoustic Oscillations (BAO) wiggles.
#omega_cdm = 1e-15          # Standard CDM set to ~0. We replace it with IDM below.
omega_cdm = 1e-15
#Omega_m = 0.286        	   # Matter density as stated in COZMIC paper 
Omega_dmeff = 0.237                           # Total Matter = Omega_b + Omega_dmeff.

# --- Neutrinos ---
# N_ur=3.044 + N_ncdm=0 implies "Massless Neutrinos".
# This is standard for IDM zoom-ins to isolate DM physics from Neutrino suppression.
N_ur = 3.044
#N_ur = 2.0328
#N_ncdm = 1
#m_ncdm = 0.06
Omega_k = 0.               # Flat universe assumption.

# --- Thermodynamics & Reionization ---
# Standard parameters. These affect the CMB but have negligible impact on 
# the Matter Transfer Function at z=99.
YHe = BBN
recombination = HyRec
reio_parametrization = reio_camb
z_reio = 7.6711
reionization_exponent = 1.5
reionization_width = 0.5
helium_fullreio_redshift = 3.5
helium_fullreio_width = 0.5
varying_fundamental_constants = none

# --- IDM "Dark Radiation" / Interaction Details ---
# These fine-tune the interaction history (e.g., drag epochs).
Omega_dcdmdr = 0.0
stat_f_idr = 0.875
Omega_idm_dr = 0.
alpha_idm_dr = 1.5
beta_idr = 1.5
Omega_fld = 0
Omega_scf = 0
dmeff_target = hydrogen    # IDM scatters off Baryons (Hydrogen).
Vrel_dmeff = 0.0           # Relative velocity target.
f_eff_type = on_the_spot
chi_type = CK_2004

# --- Exotic Energy Injection (Disabled) ---
DM_annihilation_efficiency = 0.
DM_decay_fraction = 0.
DM_decay_Gamma = 0.
PBH_evaporation_fraction = 0.
PBH_evaporation_mass = 0.
PBH_accretion_fraction = 0.
PBH_accretion_mass = 0.
PBH_accretion_recipe = disk_accretion
PBH_accretion_ADAF_delta = 1.e-3
PBH_accretion_eigenvalue = 0.1

# --- Primordial Power Spectrum ---
# Controls the vertical normalization (Amplitude) and tilt.
Pk_ini_type = analytic_Pk
k_pivot = 0.05
n_s = 0.96                 # Scalar spectral index (Tilt).
alpha_s = 0.               # Running.
sigma8 = 0.82              # Amplitude Normalization. MUSIC often renormalizes to this value,
                           # but it's good to have the input file roughly match.

# --- Gravitational Lensing ---
lensing = no               # Not needed for z=99 Transfer Functions. Saves time.

# --- Spectral Distortions (Disabled) ---
sd_branching_approx = exact
sd_PCA_size = 2
sd_detector_name = PIXIE
sd_only_exotic = no
sd_include_g_distortion = no
sd_add_y = 0.
sd_add_mu = 0.
include_SZ_effect = no

# --- Output Settings ---
z_pk = 99                  # Critical: The redshift of the output file. 
                           # MUSIC needs z=99 (Deep linear regime) to generate ICs.
headers = yes              # Includes column names in the file.
write_background = no      # Background usually only needed from the Newtonian run.
write_parameters = yes     # Saves a copy of this file (good for records).
write_thermodynamics = no
write_primordial = no
write_exotic_injection = no
write_distortions = no
write_warnings = no
overwrite_root = no        # Prevents accidental deletion of data.

# =========================================================
#  THE FIX: High Precision Settings for Small-Scale Cutoffs
# =========================================================
# These settings prevent "wobbles" and "noise floors" at high k.

# 1. Scale Range
# Increased from 200 to 300 to ensure the cutoff tail is fully captured.
# (Input is in Physical Units [1/Mpc]. 300/0.7 ~= 428 h/Mpc).
P_k_max_1/Mpc = 200.       

# 2. Sampling Density
# Forces CLASS to calculate 50 points per decade. 
# Standard is 10. High sampling is required to resolve the sharp IDM cutoff smoothy.
k_per_decade_for_pk = 50   

# 3. Angular Precision
# Required for accuracy at very high k (small scales/subhalos).
l_max_scalars = 5000       

# 4. Integration Tolerances
# Critical: Forces the solver to track tiny perturbations (1e-10) without giving up.
# This prevents the "Middle" model from hitting a noise floor and crossing the Envelope.
tol_ncdm_bg = 1.e-10
tol_ncdm_synchronous = 1.e-10
tol_ncdm_newtonian = 1.e-10
tol_perturbations_integration = 1.e-8
tol_background_integration = 1.e-8
